# 英语学习应用 - 单词记忆流程设计

## 技术栈
- **发音评估**: Azure Speech API
- **智能辅导**: DeepSeek API
- **TTS**: edge-tts

---

## 流程参数设定

| 参数 | 设定 | 说明 |
|------|------|------|
| **扩展练习触发** | 评分 < 60 时触发 | 只有发音明显有问题时才进行扩展练习 |
| **复习发音评估** | 仅对薄弱词评估 | 只对之前发音评分低的单词进行跟读评估 |
| **DeepSeek 调用** | 每个步骤都调用 | 听、看、用、写、测每个环节都提供智能反馈 |
| **薄弱词定义** | 发音评分 < 70 或 拼写错误 >= 2次 | 复习时需要额外关注的单词 |

---

## 一、新词学习流程（五步学习法）

### Step 1: 听 - 建立语音表征

**系统操作**
- 播放标准发音（慢速 + 正常速度）
- 显示音标
- 提示学生跟读

**学生操作**
- 跟读单词

**Azure 评估**
- 返回总分 (0-100)
- 返回音素级评分
- 标识问题音素

**DeepSeek 分析**（每次必调用）
- 输入: 单词、音标、Azure 评分、音素详情、学生历史
- 输出:
  - 诊断: 具体问题描述
  - 发音技巧: 舌位、口型、气息指导
  - 鼓励话语

**评分 < 60 时额外触发**
- 扩展练习词 (2-3个相似音标词)
- 依次跟读扩展词，每个词都评估
- 主单词重试（最多3次）

---

### Step 2: 看 - 建立视觉表征

**系统展示**
- 单词拼写（高亮）
- 音标（英式/美式）
- 词性 + 中文释义
- 词根词缀分析（如适用）

**DeepSeek 生成**（每次必调用）
- 输入: 单词、词性、释义
- 输出:
  - 联想记忆法: 图像/故事联想
  - 词源故事: 单词来源
  - 易混淆词: 列出并对比
  - 记忆口诀: 简短好记

**学生操作**
- 阅读信息
- 确认进入下一步

---

### Step 3: 用 - 建立语境理解

**系统展示**
- 教材原句（如词库中有）

**DeepSeek 生成**（每次必调用）
- 输入: 单词、词性、学生年级
- 输出:
  - 场景例句（3句）:
    - 校园场景
    - 家庭场景
    - 日常生活场景
  - 填空题: 挖空目标单词的句子
  - 选择题: 选择正确使用场景

**学生操作**
- 完成填空/选择练习
- 正确 → 进入下一步
- 错误 → DeepSeek 解释正确用法，可重试

**可选**
- 场景句子跟读（播放例句 TTS）

---

### Step 4: 写 - 强化拼写记忆

**系统操作**
- 播放单词发音
- 提示: "请根据发音写出单词"

**学生操作**
- 输入单词拼写

**拼写检查**
- 正确 → 进入下一步
- 错误 → 分析错误类型:
  - 字母遗漏
  - 字母多余
  - 字母顺序错误
  - 相似字母混淆

**DeepSeek 分析**（每次错误必调用）
- 输入: 正确拼写、学生输入、错误类型
- 输出:
  - 错误诊断
  - 拼写技巧
  - 易错点提醒
  - 相似拼写词对比

**重试规则**
- 最多3次
- 每次错误都调用 DeepSeek 给出不同角度的提示

---

### Step 5: 测 - 评估初始记忆质量

**系统操作**
- 显示中文释义
- 提示: "请写出对应的英文单词"
- 开始计时

**学生操作**
- 输入英文单词

**记忆质量评估**
| 响应时间 + 正确性 | 质量分数 | 含义 |
|------------------|---------|------|
| < 2秒正确 | 5分 | 轻松回忆 |
| 2-5秒正确 | 4分 | 正确回忆 |
| 5-10秒正确 | 3分 | 犹豫回忆 |
| > 10秒正确 | 2分 | 困难回忆 |
| 错误 | 1分 | 遗忘 |

**DeepSeek 总结**（每次必调用）
- 输入: 整个学习过程的数据
- 输出:
  - 本次学习总结
  - 复习建议
  - 鼓励话语
  - 相关词推荐

**后续操作**
- 记录学习结果
- 初始化 FSRS 参数
- 计算首次复习时间

---

## 二、复习流程

### 薄弱词判定

- 发音评分 < 70
- 或拼写错误 >= 2次

### 普通词复习

**模式一: 快速回忆**
- 显示中文 → 学生输入英文 → 检查 → 更新 FSRS

**模式二: 听写**
- 播放发音 → 学生输入拼写 → 检查 → 更新 FSRS

**模式三: 语境填空**
- DeepSeek 生成句子 → 学生填空 → 检查

### 薄弱词复习（额外增加发音评估）

1. 播放标准发音
2. 学生跟读 → Azure 评估
3. 与上次评分对比

**DeepSeek 进度反馈**
- 输入: 本次评分、上次评分、历史平均
- 输出:
  - 进步反馈 / 改进建议
  - 是否继续作为薄弱词的判断

4. 继续常规复习流程

---

## 三、学习记录数据结构

### 基本信息

| 字段 | 说明 |
|------|------|
| 记录ID | 唯一标识 |
| 学生ID | 学生唯一标识 |
| 时间戳 | 学习时间 |
| 单词 | 目标单词 |
| 单元 | 所属单元 |
| 词性 | 词性分类 |
| 学习类型 | 新学 / 复习 |

### Step 1 听 - 记录内容

| 字段 | 说明 |
|------|------|
| 发音总分 | Azure 返回的总分 (0-100) |
| 音素评分详情 | 各音素的评分 |
| 跟读次数 | 总跟读尝试次数 |
| DeepSeek 诊断 | LLM 返回的诊断内容 |
| 发音技巧 | LLM 返回的技巧建议 |
| 扩展练习触发 | 是否触发 (是/否) |
| 扩展练习词列表 | 推荐的练习词 |
| 扩展练习各词评分 | 每个扩展词的评分 |

### Step 2 看 - 记录内容

| 字段 | 说明 |
|------|------|
| 联想记忆法 | DeepSeek 生成的联想方法 |
| 词源故事 | DeepSeek 生成的词源说明 |
| 易混淆词 | 列出的易混淆词 |
| 记忆口诀 | 生成的口诀 |

### Step 3 用 - 记录内容

| 字段 | 说明 |
|------|------|
| 场景例句 | DeepSeek 生成的3个例句 |
| 填空题 | 填空题内容 |
| 填空结果 | 正确/错误 |
| 填空尝试次数 | 尝试次数 |
| 选择题 | 选择题内容 |
| 选择结果 | 正确/错误 |

### Step 4 写 - 记录内容

| 字段 | 说明 |
|------|------|
| 拼写正确 | 最终是否正确 |
| 拼写尝试次数 | 总尝试次数 |
| 错误类型列表 | 每次错误的类型 |
| 学生输入历史 | 每次输入的内容 |
| DeepSeek 拼写提示 | 各次错误的提示内容 |

### Step 5 测 - 记录内容

| 字段 | 说明 |
|------|------|
| 测试正确 | 是否正确 |
| 响应时间 | 从显示到提交的秒数 |
| 记忆质量分数 | 1-5 分 |
| DeepSeek 学习总结 | 本次学习的总结 |
| 复习建议 | LLM 给出的复习建议 |
| 相关词推荐 | 推荐的相关词 |

### 综合记录

| 字段 | 说明 |
|------|------|
| 总学习时长 | 整个流程耗时（秒） |
| 薄弱点标记 | 是否标记为薄弱词 |
| 薄弱点类型 | 发音/拼写/综合 |

### FSRS 状态快照

| 字段 | 说明 |
|------|------|
| difficulty | 当前难度 (1-10) |
| stability | 当前稳定性 (天数) |
| retrievability | 当前可提取性 (0-1) |
| last_review | 上次复习时间 |
| next_review | 下次复习时间 |
| review_count | 总复习次数 |
| lapses | 遗忘次数 |
| state | learning / reviewing / relearning |

---

## 四、FSRS 调度参数

### 核心概念

| 参数 | 含义 | 范围 | 说明 |
|------|------|------|------|
| D (Difficulty) | 难度 | 1-10 | 单词本身的难度，越高越难记 |
| S (Stability) | 稳定性 | 天数 | 记忆稳定程度，越高间隔越长 |
| R (Retrievability) | 可提取性 | 0-1 | 当前能回忆起的概率 |

### 应用配置参数

| 参数 | 默认值 | 建议值（初中生） | 说明 |
|------|--------|----------------|------|
| request_retention | 0.9 | 0.85 | 期望记忆保持率 |
| maximum_interval | 365 | 180 | 最大复习间隔（天） |
| max_reviews_per_day | 100 | 50 | 每日最大复习数 |
| max_new_per_day | 20 | 10 | 每日最大新词数 |

### 初始学习质量 → FSRS 初始化

| 记忆质量 | 初始难度 D0 | 初始稳定性 S0 | 首次复习间隔 |
|---------|------------|--------------|-------------|
| 5 (轻松回忆) | ~3.5 | ~23 天 | ~21 天 |
| 4 (正确回忆) | ~5.0 | ~15 天 | ~14 天 |
| 3 (犹豫回忆) | ~6.5 | ~3 天 | ~3 天 |
| 2 (困难回忆) | ~7.5 | ~1 天 | ~1 天 |
| 1 (遗忘) | ~8.5 | ~0.4 天 | ~10 小时 |

### 复习质量评分 → FSRS 更新

| 评分 | 含义 | 对 FSRS 的影响 |
|-----|------|---------------|
| 1 (Again) | 完全忘记 | 稳定性大幅降低，进入"重新学习"状态 |
| 2 (Hard) | 困难回忆 | 稳定性小幅增长，施加惩罚系数 |
| 3 (Good) | 正确回忆 | 稳定性正常增长 |
| 4 (Easy) | 轻松回忆 | 稳定性大幅增长，施加奖励系数 |

### 复习优先级计算

| 因素 | 权重 | 说明 |
|------|------|------|
| 逾期天数 | ×10 | 逾期越久越优先 |
| 低稳定性 | (30-S)×2 | 稳定性越低越优先 |
| 高难度 | +D | 难度越高越优先 |
| 遗忘次数 | ×5 | 经常遗忘的优先 |

---

## 五、DeepSeek 调用汇总

| 步骤 | 调用场景 | 主要输入 | 主要输出 |
|------|---------|---------|---------|
| Step 1 听 | 每次跟读后 | 单词、音标、评分、音素详情、历史 | 诊断、技巧、鼓励；评分<60时额外输出扩展练习词 |
| Step 2 看 | 展示单词时 | 单词、词性、释义 | 联想记忆、词源故事、易混淆词、记忆口诀 |
| Step 3 用 | 进入该步骤时 | 单词、词性、年级 | 场景例句、填空题、选择题 |
| Step 4 写 | 每次拼写错误时 | 正确拼写、学生输入、错误类型 | 错误诊断、拼写技巧、易错点 |
| Step 5 测 | 测试完成后 | 整个学习过程数据 | 学习总结、复习建议、鼓励、相关词推荐 |
| 复习-薄弱词 | 发音评估后 | 本次评分、上次评分、历史平均 | 进步反馈、改进建议 |

---

## 六、Azure + DeepSeek 协作流程

1. 用户跟读
2. Azure Speech API 评估，返回:
   - 准确度分数
   - 流畅度分数
   - 音素级评分列表
   - 错误类型标识
3. 将 Azure 结果 + 学生历史 传给 DeepSeek
4. DeepSeek 返回:
   - 问题诊断
   - 发音技巧
   - 扩展练习词（如需要）
   - 练习句子
   - 鼓励话语
5. 展示给学生
6. 保存完整记录

---

## 后续细化方向

1. 各步骤的 DeepSeek Prompt 模板设计 ✅ (见 deepseek_prompt_templates.md)
2. 学习记录数据库表结构设计
3. 前端交互界面原型
4. API 接口定义
5. 异常处理流程（网络错误、API 超时等）
